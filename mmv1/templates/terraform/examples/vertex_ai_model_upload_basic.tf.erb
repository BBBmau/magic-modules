resource "google_vertex_ai_models" "platform_model" {
  display_name = "platform"
  artifact_uri = "gs://cloud-samples-data/vertex-ai/google-cloud-aiplatform-ci-artifacts/models/iris_xgboost/"
  description  = "platform model"

  region       = "us-central1"
}

resource "google_vertex_ai_models" "<%= ctx[:primary_resource_id] %>" {
  display_name = "<%= ctx[:vars]['display_name'] %>"
  description  = "basic upload model"

  metadata_schema_uri   = "gs://google-cloud-aiplatform/schema/dataset/metadata/image_1.0.0.yaml"

  version_aliases = ["v2beta1"]
  model_id = "id_upload_test"
  parent_model = google_vertex_ai_models.platform_model.display_name

  encryption_spec {
    kms_key_name = "test"
  }

  metadata {
    config {
      algorithm_config {
        tree_ah_config {
          leaf_node_embedding_count    = 1
          leaf_nodes_to_search_percent = 1
        }
      }
      approximate_neighbors_count = 1
      dimensions                  = 1
      distance_measure_type       = 1
      feature_norm_type           = "normal"
      shard_size                  = 1
    }
    contents_delta_uri    = "test"
    is_complete_overwrite = false
  }

  labels       = {
    "key1" : "value1",
    "key2" : "value2"
  }
  region       = "us-central1"
  depends_on = [google_vertex_ai_models.platform_model]
}