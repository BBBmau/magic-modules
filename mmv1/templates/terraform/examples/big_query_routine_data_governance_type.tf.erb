resource "google_bigquery_dataset" "test" {
	dataset_id = "<%= ctx[:vars]['dataset_id'] %>"
}

resource "google_bigquery_routine" "sproc" {
  dataset_id = google_bigquery_dataset.test.dataset_id
  routine_id     = "<%= ctx[:vars]['routine_id'] %>"
  routine_type = "PROCEDURE"
  data_governance_type = "DATA_MASKING"
  language = "SQL"
  definition_body = "CREATE FUNCTION SSN_Mask(ssn STRING) RETURNS STRING AS (SAFE.REGEXP_REPLACE(ssn, '[0-9]', 'x'));"
}

